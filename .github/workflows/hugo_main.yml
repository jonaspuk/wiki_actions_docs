name: Hugo
on:
  workflow_dispatch:
  schedule:
    - cron:  '54 * * * 1-5'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Wiki
      uses: actions/checkout@v2
      with:
        repository: '${{ github.repository }}.wiki'
        path: 'wiki'
    - name: Checkout Main Repo
      uses: actions/checkout@v2
      with:
        path: 'main'
    - name: Sync repo's
      run: rsync -avz --exclude '.git' wiki/ main/docs
    - name: Print main repo contents
      run: ls -la main/docs && ls -la wiki
    - name: Define a Dockerfile
      run: |
        echo -e "# Container image that runs your code \n
        FROM klakegg/hugo:0.88.0-ext-ubuntu-onbuild \n
        COPY entrypoint.sh /entrypoint.sh \n
        # Code file to execute when the docker container starts up (entrypoint.sh) \n
        ENTRYPOINT ["/entrypoint.sh"]" > /tmp/Dockerfile
        echo
        cat /tmp/Dockerfile
    - name: Build a Hugo Docker Image
#     run: docker://
    - name: Pushing from wiki to docs
      run: |
        cd main
        date > /tmp/generated.txt
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add .
        git commit -m "$(cat /tmp/generated.txt)" || echo #this is to change the return code to 0
        git push