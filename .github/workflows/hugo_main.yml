name: Convert .wiki docs to static pages using Hugo
on:
  workflow_dispatch:
  schedule:
    - cron:  '51 * * * 1-5'
jobs:
  Build:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout Wiki
      uses: actions/checkout@v2
      with:
        repository: '${{ github.repository }}.wiki'
        path: 'wiki'
    - name: Checkout Main Repo
      uses: actions/checkout@v2
      with:
        repository: '${{ github.repository }}'
        path: 'main'
    - name: Copy wiki files to docs
      run: rsync -avz --exclude '.git' wiki/ main/docs
    - name: Print main repo contents
      run: ls -la main/docs && ls -la wiki
    - name: Define a Dockerfile
      run: |
        echo -e "# Container image that runs your code \n
        FROM klakegg/hugo:0.88.0-ext-ubuntu-onbuild \n
        COPY docs/main/* /md_files/ \n
        # Code file to execute when the docker container starts up (entrypoint.sh) \n
        ENTRYPOINT ["/entrypoint.sh"]" > /tmp/Dockerfile
        echo
        cat /tmp/Dockerfile
    - name: Build a Hugo Docker Image
      run: echo "not actually building anything just yet"
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: '0.88.0'
        extended: true
    - name: Creating a site and pulling a theme
      run: |
        hugo new site mydocs &>/dev/null; cd mydocs
        git clone https://github.com/alex-shpak/hugo-book themes/book
        cp -R themes/book/exampleSite/content .
        hugo -D -v --minify --theme book -d ../main/docs/
    - name: Creting static HTML files
      run: |
        ls -la main/docs
    - name: Pushing from wiki to docs
      run: |
        cd main
        date > /tmp/generated.txt
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add .
        git commit -m "$(cat /tmp/generated.txt)" || echo #this is to change the return code to 0
        git push